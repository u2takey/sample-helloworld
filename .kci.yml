pipeline:
  build:
    image: index.qiniu.com/kci/golang:1.6
    commands:
      - chdir go
      - go build helloworld.go
      - echo $TESTA
  build:
    image: index.qiniu.com/kci/golang:1.6
    commands:
      - chdir go
      - go build helloworld.go
      - echo "has testa" 
    when:
      matrix:
        TESTA: "a"
#  index.qiniu.com/kci/plugin_docker:
#    repo: wanglei/sample-helloworld
#    workdir: ./go
#    tag: latest
#    kirk_autoupdate: [ wanglei.wanglei2/default/helloworld, wanglei.wangtest/default/helloworld1 ] 
  index.qiniu.com/kci/plugin_kodo:
      bucket: test
      source: .
      target: /
      delete: true
      zone: 1
  index.qiniu.com/kci/plugin_email:
    recipients:
      - 541004974@qq.com
    when:
      event: [push, pull_request, tag, deployment]
      status:  [ failure, success ]
  slack:
    image: index.qiniu.com/kci/plugin_slack
    webhook: https://hooks.slack.com/services/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
    channel: kirk_kci_alert
    recipient: wanglei
    template: |
     {{ #success build.status }}
      build {{ repo.owner }} / {{ repo.name }} / {{ build.branch }} : {{ build.number }} succeeded.
     {{ else }}
      build {{ repo.owner }} / {{ repo.name }} / {{ build.branch }} : {{ build.number }} failed. Fix me please.
     {{ /success }}
     {{ build.event }} by {{ build.author }} at {{ build.started }}
